<!DOCTYPE html>
<html>
  <head>
    
    <link href="css/reset.css" rel="stylesheet" />
    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="shortcut icon" href="css/favicon.png" />
    <link rel="apple-touch-icon" href="css/apple-touch-icon.png" />
    <!-- Code Prettifier: -->
<link href="css/highlight.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <link href="css/style.css" rel="stylesheet" />
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,800italic,300,400,800' rel='stylesheet' type='text/css'>    


  </head>

  <body>
  <div class="fallback-message">
  <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
  <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
  </div>
    <div id="impress">
    <div class='step' >
    
<h1>Extending Minitest</h1>

<h2>Samuel Mullen</h2>
</div>
      <div class='step' >
    
<h2>Extending Minitest 5</h2>

<ul>
<li>New assertions and expectations</li>
<li>Plugins

<ul>
<li>Progress Reporters</li>
<li>Statistics Reporters</li>
</ul></li>
</ul>
</div>
      <div class='step' >
    
<p>Note:</p>

<ul>
<li>I will be focusing on Minitest::Spec

<ul>
<li>i.e. Expectations</li>
</ul></li>
<li>I&#39;m assuming some familiarity with testing</li>
</ul>
</div>
      <div class='step' >
    
<h2>Reasons I use Minitest</h2>

<ul>
<li>It comes standard with Ruby &gt;= 1.9</li>
<li>It&#39;s easy to learn

<ul>
<li>I never felt like I was using Rspec to it&#39;s full potential</li>
</ul></li>
<li>It&#39;s fast!</li>
<li>It&#39;s easy to hack</li>
</ul>
</div>
      <div class='step' >
    
<h1>Adding Assertions and Expectations</h1>
</div>
      <div class='step' >
    
<h2>Why would you want to add new Assertions and Expectations?</h2>

<ul>
<li>Readability

<ul>
<li><code class='inline prettyprint'>some_decimal.must_round_to 3</code></li>
<li>... is more readable than ...</li>
<li><code class='inline prettyprint'>some_decimal.round.must_equal 3</code></li>
</ul></li>
<li>It&#39;s DRYer</li>
</ul>
</div>
      <div class='step' >
    
<h2>Adding the new Assertion</h2>

<h3>It&#39;s just &quot;monkypatching&quot;</h3>
<pre><code class='prettyprint ruby'>class Minitest::Assertion
  def assert_admin(obj, msg=nil)
    msg = message(msg, "") { diff true, obj.admin? }
    assert true == obj.admin?, msg
  end

  def refute_admin(obj, msg=nil)
    msg = message(msg, "") { diff false, obj.admin? }
    assert false == obj.admin?, msg
  end
end
</code></pre></div>
      <div class='step' >
    
<h2>Adding the Expectation</h2>

<h3><code class='inline prettyprint'>infect_an_assertion</code></h3>
<pre><code class='prettyprint ruby'>class Minitest::Assertion
  infect_an_assertion :assert_admin, :must_be_admin, :unary

  infect_an_assertion :refute_admin, :wont_be_admin, :unary

end
</code></pre></div>
      <div class='step' >
    
<h2>Expectation Flags</h2>

<h3>:unary and :reverse</h3>

<ul>
<li>Most Assertions and Expectations won&#39;t use them</li>
<li>just &quot;truthy&quot; values

<ul>
<li>could be <code class='inline prettyprint'>true</code>, <code class='inline prettyprint'>1</code>, or even <code class='inline prettyprint'>:foo</code> </li>
</ul></li>
<li>Flips the order of the method call

<ul>
<li>Example: <code class='inline prettyprint'>must_include</code></li>
</ul></li>
</ul>
</div>
      <div class='step' >
    
<h1>Minitest Plugins</h1>
</div>
      <div class='step' >
    
<h2>Minitest 5</h2>

<h3>April 24, 2013 - Oh God... here we go</h3>

<p>9a57c520ceac76abfe6105866f8548a94eb357b6</p>
</div>
      <div class='step' >
    
<h2>How Minitest 5 Works</h2>
</div>
      <div class='step' >
    
<h2>include &quot;minitest/autorun&quot;</h2>
<pre><code class='prettyprint ruby'>require "minitest"
require "minitest/spec"
require "minitest/mock"

Minitest.autorun
</code></pre></div>
      <div class='step' >
    
<h2>At Exit (minitest.rb)</h2>
<pre><code class='prettyprint ruby'>def self.autorun
  at_exit {
    next if $! and not $!.kind_of? SystemExit

    exit_code = nil

    at_exit {
      @@after_run.reverse_each(&:call)
      exit exit_code || false
    }

    exit_code = Minitest.run ARGV # <--
  } unless @@installed_at_exit
  @@installed_at_exit = true
end
</code></pre></div>
      <div class='step' >
    
<h2>Loading Plugins</h2>
<pre><code class='prettyprint ruby'>def self.run args = []
  self.load_plugins # <-- key

  options = process_args args

  reporter = CompositeReporter.new
  reporter << ProgressReporter.new(options[:io], options)
  reporter << SummaryReporter.new(options[:io], options)

  self.reporter = reporter # make it available to plugins
  self.init_plugins options # <-- key

  ...

end
</code></pre></div>
      <div class='step' >
    
<h2>Summarized</h2>

<ol>
<li>include &#39;minitest/autorun&#39; </li>
<li>starts up via <code class='inline prettyprint'>at_exit</code></li>
<li>Runs Minitest::run

<ol>
<li>Load the plugins</li>
<li>Load the default reporters</li>
<li>Initialize the plugins</li>
</ol></li>
</ol>
</div>
      <div class='step' >
    
<h1>Example Ruby</h1>
<pre><code class='prettyprint ruby'>class Foo
  def initialize
    @bar = 'something'
  end
end
</code></pre></div>
      <div class='step' >
    
<h1>The how and why of minitest&#39;s design (i.e. history)</h1>
</div>
      <div class='step' >
    
<h1>How minitest works:</h1>
</div>
      <div class='step' >
    
<h1>Plugins</h1>

<ul>
<li>Progress</li>
<li>Reporters

<ul>
<li>Export results to:</li>
</ul></li>
</ul>
</div>
      <div class='step' >
    
<p>Assertions and Expectations</p>

<p>Read the Code
* It&#39;s very approachable
* It&#39;s very funny</p>

      </div>
    <script src="js/impress.js"></script>
    <script>impress().init();</script>
  </body>
</html>
    